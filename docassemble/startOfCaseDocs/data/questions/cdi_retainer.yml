---
modules:
  - docassemble.base.util
  - docassemble.base.legal
---
metadata:
  title: |
    Start of Case Documents - Western New England School of Law CSJ CDI
  description: |
    An interview to get a signed Western New England School of Law CSJ CDI Retainer
  authors:
     - name: Matt Brooks
       organization: Greater Boston Legal Services
  revision_date: 2020-06-22
---
objects:
  - advocate: Individual
  - client: Individual
---
comment: |
  ## One of two mandatory blocks in the interview. Controls the order in which 
  ## the interview asks questions. Only other mandatory block is client end screen.
mandatory: True
code: |
  multi_user = True
  client.name.first
  advocate.name.first
  advocate.signature
  we_have_switched
  client_splash_seen
  client.signature
  agrees_to_sign
  success_sending_email
---
question: |
  Enter your client's first and last name.
fields:
  - First Name: client.name.first
  - Last Name: client.name.last
---
question: |
  Tell me your name and email address.
fields:
  - First Name: advocate.name.first
  - Last Name: advocate.name.last
  - Email Address: advocate.email
    datatype: email
---
comment: |
  ## Main question text is put in the "under:" statement here because it displays
  ## better on mobile, and prevents the question text from blocking the touch
  ## screen.
question: |
  ${ client.name.firstlast() }
signature: client.signature
under: |
  Sign your name here by using your mouse or touching your phone's screen.
  Press clear if you want to start over. You will be able to review your 
  documents before they are sent to your advocate.
---
question: |
  Sign your name here.
subquestion: |
  Your signature will appear on the retainer.
signature: advocate.signature
under: |
  ${ advocate.name.firstlast() }
---
sets: we_have_switched
comment: |
  ## Docassemble needs the helps of "sets:" here to understand that this screen
  ## will lead to we_have_switched being defined. I don't think docassemble's
  ## logic understands that interview_url(switch=True) defines url_args, which
  ## needs to be defined in order to get the code in the next block to run.
  
  ## This is the ending screen for the advocate. The interview_url() function
  ## takes arguments, and passes them to the interview's url--with a unique
  ## session ID--as url_args(). We then use code in the next block to define
  ## the variable we_have_switched if 'switch' is in the url_args. The mandatory
  ## block of this interview needs we_have_switched to be defined in order to
  ## proceed, so clicking the link generated by this screen is the only way to
  ## proceed with the rest of the interview.
question: |
    Send your client this link by right clicking on it and selecting copy. It will take     them to the rest of the interview. Docassemble will send you your client's signed 
    documents when they are ready, or let you know if your client indicates that 
    they don't agree to sign the documents.
 
    [link to documents](${ interview_url(switch=True) })
    
subquestion: |
  Once you have sent the link to your client, you may close this window.
---
comment: |
  ## defines we_have_switched, allowing the interview to proceed.
code: |
  if 'switch' in url_args:
    we_have_switched = True
---
comment: |
  ## This is the first screen the client sees upon clicking the link provided by
  ## their advocate.
question: |
  Welcome! You are here because your advocate needs you to review some documents,
  and sign them if you agree. The next screen will ask you for a sample of your 
  signature, but you will be given a chance to review any documents your advocate
  wants you to sign before they are sent you your advocate. Your signature will
  not be used without your permission.
field: client_splash_seen
subquestion: |
  Click "Continue" to keep going with the interview.
---
comment: |
  ## displays the documents that the advocate specified they needed on the screen.
  ## Also allows the client to download a zip file of all the documents for their
  ## records. Prompts the client to click yes if they agree to sign, or no
  ## otherwise.
question: |
  Here are your documents. Please review them, and click yes if you agree to
  sign them. Otherwise, click no, and your advocate will be notified.
  
  ${ signed_retainer }

  
  You can download copies for your records here
  ${zip_file(signed_retainer, filename="Your Documents.zip")} 
  
  If you agree to sign all of these documents, click yes. Otherwise, click no.
yesno: agrees_to_sign
---
attachment:
  - name: Retainer
    variable name: signed_retainer
    filename: Retainer_Signed
    valid formats:
      - pdf
    docx template file: wnecsj_cdi_retainer.docx
---
comment: |
  ## Sends the document package to the advocate if the client agrees to sign.
  ## Otherwise, lets the advocate know that the client didn't agree to sing the
  ## documents.
need:
  - agrees_to_sign
code: |
  if agrees_to_sign == True:
    send_email(to=[advocate.email], subject=str(client.name.firstlast()) + " Document Package", attachments=[signed_retainer])
    success_sending_email = True
  else:
    send_email(to=[advocate.email], subject=str(client.name.firstlast()) + " did not agree to sign")
    success_sending_email = False
---
mandatory: True
question: |
  % if success_sending_email == True:
    Your interview is complete.
    Your documents have been sent to your advocate.
  % elif success_sending_email == False:
    You have not agreed to sign your documents.
    Your advocate has been notified and will reach out to you.
  % else:
    Something went wrong. Please call or email your advocate to let them know.
  % endif
subquestion: |
  You may now close this window.